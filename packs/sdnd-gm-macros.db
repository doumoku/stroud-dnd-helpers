{"name":"Combat Music","type":"script","author":"6yhz13iFYYklKtgA","img":"icons/tools/instruments/drum-snare-red.webp","scope":"global","command":"stroudDnD.music.combat.toggle()","flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false,"runForSpecificUser":""},"core":{"sourceId":"Macro.9dMUjx4EQowvxazr"}},"ownership":{"default":0,"6yhz13iFYYklKtgA":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683057647543,"modifiedTime":1683057647543,"lastModifiedBy":"6yhz13iFYYklKtgA"},"folder":null,"sort":0,"_id":"JgKTwBOGa7FbU1p2"}
{"name":"Add to Combat","type":"script","scope":"global","author":"6yhz13iFYYklKtgA","img":"https://assets.forge-vtt.com/634b24b96df3a5a10e8ccd71/custom_icons/addToCombat2.webp","command":"stroudDnD.combat.startFilteredCombat();","ownership":{"default":0,"6yhz13iFYYklKtgA":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true,"runForSpecificUser":""},"core":{"sourceId":"Macro.jmJJ0Aye5e7RnGOE"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1683056273405,"modifiedTime":1683057707785,"lastModifiedBy":"6yhz13iFYYklKtgA"},"folder":null,"sort":0,"_id":"OoGNpg9Azbt18pwI"}
{"name":"Give Money","type":"script","author":"6yhz13iFYYklKtgA","img":"icons/svg/coins.svg","scope":"global","command":"/*\nDistribute money across players in scene.\nSyncUrl=https://raw.githubusercontent.com/matthewbstroud/foundry_scripts/main/v10/Money/giveMoney.js\n*/\nlet sharees = canvas.scene.tokens.filter((token) => token.actor && token.actor.folder.name == \"Players\").map(t => t.actor);\nif (sharees.length == 0) {\n    ui.notifications.notify('There are no character tokens in this scene.');\n    return;\n}\n\nlet controlledActors = canvas.tokens.controlled.filter((token) => token.actor && token.actor.type == 'character').map(t => t.actor);\nif (controlledActors.length > 0) {\n    sharees = controlledActors;\n}\n\nlet actorCount = sharees.length;\nlet permissionCheck = false;\nif (game.user.isGM == true || game.user.isTrusted == true) { permissionCheck = true; }\n\nfunction updateActorCurrency(targetActor, newTotalCP) {\n    let newPP = Math.floor(newTotalCP / 1000);\n    newTotalCP -= newPP * 1000;\n    let newGP = Math.floor(newTotalCP / 100);\n    newTotalCP -= newGP * 100;\n    let newEP = Math.floor(newTotalCP / 50);\n    newTotalCP -= newEP * 50;\n    let newSP = Math.floor(newTotalCP / 10);\n    newTotalCP -= newSP * 10;\n\n    targetActor.update(\n        {\n            \"system.currency.pp\": newPP,\n            \"system.currency.gp\": newGP,\n            \"system.currency.ep\": newEP,\n            \"system.currency.sp\": newSP,\n            \"system.currency.cp\": newTotalCP\n        });\n}\n\nfunction toNumber(val) {\n    if (!val || val == '') {\n        return 0;\n    }\n    return Number(val);\n}\n\nfunction getShareAmount(sharedCopper) {\n    let splitPP = Math.floor(sharedCopper / 1000);\n    sharedCopper -= splitPP * 1000;\n    let splitGP = Math.floor(sharedCopper / 100);\n    sharedCopper -= splitGP * 100;\n    let splitEP = Math.floor(sharedCopper / 50);\n    sharedCopper -= splitEP * 50;\n    let splitSP = Math.floor(sharedCopper / 10);\n    sharedCopper -= splitSP * 10;\n    let strShareAmount = \"\";\n    if (splitPP > 0) { strShareAmount += \"<span style='color:#90A2B6'>\" + splitPP + \"pp</span>\"; if (splitGP > 0 || splitEP > 0 || splitSP > 0 || sharedCopper > 0) { strShareAmount += \", \"; } }\n    if (splitGP > 0) { strShareAmount += \"<span style='color:#B08C34'>\" + splitGP + \"gp</span>\"; if (splitEP > 0 || splitSP > 0 || sharedCopper > 0) { strShareAmount += \", \"; } }\n    if (splitEP > 0) { strShareAmount += \"<span style='color:#617480'>\" + splitEP + \"ep</span>\"; if (splitSP > 0 || sharedCopper > 0) { strShareAmount += \", \"; } }\n    if (splitSP > 0) { strShareAmount += \"<span style='color:#717773'>\" + splitSP + \"sp</span>\"; if (sharedCopper > 0) { strShareAmount += \", \"; } }\n    if (sharedCopper > 0) { strShareAmount += \"<span style='color:#9D5934'>\" + sharedCopper + \"cp</span>\"; }\n    return strShareAmount;\n}\n\nfunction giveCurrency(totalPP, totalGP, totalEP, totalSP, totalCP) {\n    let totalToShare = (totalPP * 1000) + (totalGP * 100) + (totalEP * 50) + (totalSP * 10) + totalCP\n    let splitCP = Math.floor(totalToShare / actorCount);\n    if (splitCP === 0) {\n        ui.notifications.notify(`Cannot split ${totalToShare} copper between ${actorCount} people.`);\n        return;\n    }\n\n    let strOutput = `<b>Cha-ching!</b><br />`;\n    let sharedAmount = getShareAmount(splitCP);\n    sharees.forEach(actor => {\n        let actorCurrency = actor.system.currency;\n        let actorCurrentCP = (actorCurrency.pp * 1000) + (actorCurrency.gp * 100) + (actorCurrency.ep * 50) + (actorCurrency.sp * 10) + actorCurrency.cp;\n        let actorNewTotal = actorCurrentCP + splitCP;\n        updateActorCurrency(actor, actorNewTotal);\n        strOutput += `${actor.name} received: ${sharedAmount}<br />`;\n    });\n\n    ChatMessage.create({ content: strOutput });\n};\n\nlet currencyTotals = `\n<b>Currency Totals:</b><br />\n<div style=\"display: flex; width: 100%; margin: 10px 0px 10px 0px\">\n    <label for=\"pp\" style=\"white-space: nowrap; margin: 4px 10px 0px 10px;\">PP:</label>\n    <input type=\"number\" id=\"pp\" name=\"pp\" />\n    <label for=\"pp\" style=\"white-space: nowrap; margin: 4px 10px 0px 10px;\">GP:</label>\n    <input type=\"number\" id=\"gp\" name=\"gp\" />\n    <label for=\"pp\" style=\"white-space: nowrap; margin: 4px 10px 0px 10px;\">EP:</label>\n    <input type=\"number\" id=\"ep\" name=\"ep\" />\n    <label for=\"pp\" style=\"white-space: nowrap; margin: 4px 10px 0px 10px;\">SP:</label>\n    <input type=\"number\" id=\"sp\" name=\"sp\"/ >\n    <label for=\"pp\" style=\"white-space: nowrap; margin: 4px 10px 0px 10px;\">CP:</label>\n    <input type=\"number\" id=\"cp\" name=\"cp\"/ >\n</div>\n`;\n\nnew Dialog({\n    title: `Give Currency`,\n    content: `\n        <form>\n            ${currencyTotals}\n        </form>\n    `,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Give`,\n            callback: (html) => {\n                let totalPP = toNumber(html.find('#pp').val());\n                let totalGP = toNumber(html.find('#gp').val());\n                let totalEP = toNumber(html.find('#ep').val());\n                let totalSP = toNumber(html.find('#sp').val());\n                let totalCP = toNumber(html.find('#cp').val());\n\n                giveCurrency(Number(totalPP), Number(totalGP), Number(totalEP), Number(totalSP), Number(totalCP));\n            }\n        },\n        no: {\n            icon: \"<i class='fas fa-times'></i>\",\n            label: `Cancel`\n        },\n    },\n    default: \"yes\"\n}).render(true)","ownership":{"default":0,"6yhz13iFYYklKtgA":3},"flags":{"advanced-macros":{"runAsGM":false,"runForSpecificUser":""},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.FJFVEYCWZ0hCYEjO"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1682166361505,"modifiedTime":1683380208296,"lastModifiedBy":"6yhz13iFYYklKtgA"},"folder":null,"sort":0,"_id":"PGB1Es00S2Nmd36S"}
{"name":"Take Money","type":"script","author":"6yhz13iFYYklKtgA","img":"icons/skills/social/theft-pickpocket-bribery-brown.webp","scope":"global","command":"stroudDnD.money.takeMoney();","ownership":{"default":0,"6yhz13iFYYklKtgA":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false,"runForSpecificUser":""},"core":{"sourceId":"Macro.6kAqvPoZiDWmCXZa"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.1.5","coreVersion":"10.291","createdTime":1682372738102,"modifiedTime":1683380210601,"lastModifiedBy":"6yhz13iFYYklKtgA"},"folder":null,"sort":0,"_id":"n2OdTfMuU8On3vsq"}
